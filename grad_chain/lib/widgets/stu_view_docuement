import 'dart:js';

import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutter/material.dart';
import 'package:grad_chain/responsive/student/web_screen_layout.dart';
import 'package:grad_chain/responsive/university/uni_web_screen.dart';
import 'package:grad_chain/widgets/stu_diploma_list_card.dart';

import 'package:provider/provider.dart';

import '../models/student.dart';
import '../providers/user_provider.dart';

class StudentViewDocument extends StatefulWidget {
  final user;
  final stuuid;

  StudentViewDocument({Key? key, this.user, this.stuuid})
      : super(key: key);

  @override
  State<StudentViewDocument> createState() => _StudentViewDocumentState();
}

class _StudentViewDocumentState extends State<StudentViewDocument> {
  @override
  Widget build(BuildContext context) {
    final Student? stu = Provider.of<UserProvider>(context).getStu;

    var dipQuery = FirebaseFirestore.instance
        .collection('diplomas')
        .where('uid', isEqualTo: widget.stuuid)
        .snapshots();

    return Scaffold(
        appBar: AppBar(
            backgroundColor: Colors.grey[300],
            leading: BackButton(
              onPressed: () {
                Navigator.push(
                    context,
                    MaterialPageRoute(
                        builder: (context) => 
                             WebScreenLayout()));
              },
            )),
        body: StreamBuilder(
             stream: dipQuery,
             builder: (context,
                 AsyncSnapshot<QuerySnapshot<Map<String, dynamic>>> snapshot) {
               if (snapshot.connectionState == ConnectionState.waiting)
                 return const Center(
                   child: CircularProgressIndicator(),
                 );
        //     body:
              print(snapshot.data!.docs.length.toString());
              return Container(
                  decoration: BoxDecoration(
                    borderRadius: BorderRadius.circular(30),
                    color: Colors.white70,
                  ),
                  child: SingleChildScrollView(
                      child: Column(children: [
                    Padding(padding: EdgeInsets.fromLTRB(0, 10, 0, 0)),
                    Text(
                      'List of Diplomas',
                      style: TextStyle(
                        fontSize: 18,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    SizedBox(height: 5),
                    //debugPrint(snapshot.data!.docs.length);
                    ListView.builder(
                        shrinkWrap: true,
                        itemCount: snapshot.data!.docs.length,
                        itemBuilder: (context, index) => StudentDiplomaList(
                            snap: snapshot.data!.docs[index].data()))
                  ])));
            }));
  }
}
